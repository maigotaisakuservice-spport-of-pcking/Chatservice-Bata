<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ログイン - ChatGo</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #e0f2e9;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    form {
      background: white;
      padding: 2em;
      border-radius: 1em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    input {
      display: block;
      margin-bottom: 1em;
      padding: 0.5em;
      width: 100%;
    }
    button {
      padding: 0.5em;
      background-color: #4CAF50;
      color: white;
      border: none;
      width: 100%;
      border-radius: 0.5em;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .google-btn {
      background-color: #db4437;
    }
  </style>
</head>
<body>
  <h1>ChatGo ログイン</h1>
  <form id="loginForm">
    <input type="email" id="email" placeholder="メールアドレス" required>
    <input type="password" id="password" placeholder="パスワード" required>
    <button type="submit">ログイン</button>
    <button type="button" class="google-btn" id="googleLogin">Googleでログイン</button>
    <p><a href="reset.html">パスワードを忘れた場合</a></p>
    <p><a href="register.html">新規登録はこちら</a></p>
  </form>

  <script type="module">
    import {
      auth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup
    } from "./app.js";

    const loginForm = document.getElementById('loginForm');
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        sessionStorage.setItem('userId', user.uid);
        window.location.href = 'chat.html';
      } catch (error) {
        alert("ログイン失敗：" + error.message);
      }
    });

// Firebase 初期化（firebaseConfigは環境に合わせて設定）
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

// Firebase設定
const firebaseConfig = {
  apiKey: "AIzaSyA7CWUhLBKG_Oabxxw_7RfBpSANUoDh42s",
  authDomain: "moodmirror-login.firebaseapp.com",
  projectId: "moodmirror-login",
  storageBucket: "moodmirror-login.appspot.com",
  messagingSenderId: "1091670187554",
  appId: "1:1091670187554:web:ce919c1fca5b660995b47b",
  measurementId: "G-TPJXPMPSGZ"
};

// 初期化
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Google認証プロバイダ
const provider = new GoogleAuthProvider();

// Google ログイン処理
document.getElementById("googleLogin").addEventListener("click", async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    // ログイン後、メール認証の確認
    if (user.emailVerified) {
      alert("ログイン成功!");
      window.location.href = "chat.html"; // チャット画面へ遷移
    } else {
      alert("メール認証が完了していません。");
    }
  } catch (error) {
    console.error("ログインエラー:", error);
    alert("ログインに失敗しました。");
  }
});
  </script>
</body>
</html>

