<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ChatGo - チャット</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Specific styles for chat page */
    .container {
      max-width: 900px;
    }

    .menu {
      position: absolute;
      top: 60px;
      right: 20px;
      background-color: white;
      border: 1px solid #ccc;
      width: 250px;
      flex-direction: column;
      z-index: 1000;
      padding: 10px;
      display: none; /* Initially hidden */
    }

    .friend-list {
      margin-top: 10px;
    }

    .friend-item {
      cursor: pointer;
      padding: 8px;
      border-bottom: 1px solid #eee;
    }

    .friend-item:hover {
      background-color: #f0f0f0;
    }

    #messages {
      height: 400px;
      overflow-y: auto;
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      border-radius: 6px;
    }

    #message-form, #image-form, #video-form {
      display: flex;
      margin-top: 10px;
      gap: 10px;
    }

    #message-input {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ChatGo</h1>
      <div>
        <a href="profile.html">プロフィール</a>
        <a href="group.html">グループ</a>
        <a href="premiumlist.html">プレミアム</a>
        <button class="menu-button" onclick="toggleMenu()">≡</button>
      </div>
    </header>

    <div class="menu" id="menu">
      <input type="email" id="friend-email" placeholder="メールでフレンド検索">
      <button onclick="addFriend()">フレンド追加</button>
      <hr>
      <div class="friend-list" id="friend-list"></div>
    </div>

    <div id="chat-area">
      <div id="messages"></div>
      <form id="message-form" onsubmit="sendMessage(event)">
        <input type="text" id="message-input" placeholder="メッセージを入力">
        <button id="send-button">送信</button>
      </form>

      <form id="image-form">
        <input type="file" id="image-input" accept="image/*" />
        <button type="submit">画像送信</button>
      </form>

      <form id="video-form">
        <input type="file" id="video-input" accept="video/mp4,video/webm" />
        <button type="submit">動画を送信</button>
      </form>

      <div id="gif-ui" style="display:none; margin-top: 20px;">
        <h3>🎞️ プレミアムGIF特典</h3>
        <div id="gif-library" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
        <h4>🎨 カスタムGIF（最大3つ）</h4>
        <input type="file" id="custom-gif-upload" accept="image/gif" />
        <div id="custom-gif-list" style="display:flex; gap:10px;"></div>
      </div>
    </div>
  </div>

  <script type="module" src="chat.js"></script>
  <script>
    // This script block remains for the GIF and premium features
    // but it now depends on variables like `auth` and `db` from chat.js
    // We need to ensure `chat.js` initializes these.
    // For simplicity, this inline script is kept, but a better practice
    // would be to move this logic into chat.js as well.

    // Assuming `onAuthStateChanged`, `ref`, `get`, `push`, `set` are available globally
    // or passed from chat.js. For this to work, chat.js must not be a module
    // that hides its scope, or it must expose these functions globally.
    // The current implementation where chat.js is a module will cause errors here.
    // Let's defer fixing this potential script scope issue until a later step if it causes problems.

    let isPremiumUser = false;

    // This logic should be inside the onAuthStateChanged listener in chat.js
    // to avoid race conditions and ensure auth is initialized.
    // I will move this logic into the main onAuthStateChanged in chat.js later if needed.

    // Mock functions for now to avoid breaking the page, will be replaced by chat.js
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }
  </script>
</body>
</html>
